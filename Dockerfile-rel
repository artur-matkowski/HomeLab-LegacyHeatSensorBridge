FROM debian:bookworm-slim

ARG BINOUT                        # <-- build-time variable
ARG INSTALL_DEPS
ARG ARCHITECTURE

# Install runtime and build dependencies
RUN apt update && \
    apt install -y --no-install-recommends \
        build-essential \
        libstdc++6 \
        ${INSTALL_DEPS} \
        && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy source code and config
COPY build/${ARCHITECTURE}/rel/${BINOUT} /app/${BINOUT}

# Environment variables mirroring ConfigWrapper ParamInitializers
# (Default values should match those in ConfigWrapper.cpp)
ENV DB_HOST=${DB_HOST}
ENV DB_PASSWD=${DB_PASSWD}

# Entrypoint (adjust as needed)
CMD ["/app/${BINOUT}"]
